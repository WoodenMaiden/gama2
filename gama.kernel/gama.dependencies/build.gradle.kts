/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    `java-library`
    `maven-publish`
}


group = "gama.kernel"
version = "2.0.0-SNAPSHOT"
description = "gama.dependencies"
java.sourceCompatibility = JavaVersion.VERSION_17

publishing {
    publications.create<MavenPublication>("maven") {
        from(components["java"])
    }
}

dependencies {
    // api() will allow to expose the following dependencies to the modules that depend on gama.dependencies
    // https://www.baeldung.com/gradle-dependency-management#2-types-of-configuration

    api(project(":gama.kernel:gama.dev"))
    api(project(":gama.kernel:gama.annotations"))

    api("com.google.inject:guice:7.0.0")
    compileOnlyApi("org.osgi:org.osgi.framework:1.10.0")


    val classPathFiles = """[^\s]+[\w\d\ -_/]+\.jar""".toRegex(setOf(RegexOption.MULTILINE)).findAll(
            file("META-INF/MANIFEST.MF").readText()
    ).map{ it.value }.toList()

    logger.debug("JAR files in gama.dependencies: ")
    classPathFiles.forEach(logger::debug)

    api(files(classPathFiles))
    
}

tasks {
    jar {
        manifest {  
            from ("META-INF/MANIFEST.MF")
        }
    }
}


tasks.named<Jar>("jar") {
    dependsOn(":gama.kernel:gama.annotations:jar")
    duplicatesStrategy = DuplicatesStrategy.INCLUDE
    from(configurations.runtimeClasspath.get().filter { it.name.endsWith(".jar") }.map { zipTree(it) })
}


sourceSets.main {
    java {
        setSrcDirs(listOf("src"))
    }
    /*resources {
        setSrcDirs(listOf("resources"))
    }*/
}

